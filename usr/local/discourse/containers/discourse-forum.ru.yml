env:
  DISCOURSE_DEVELOPER_EMAILS: 'admin@discourse-forum.ru'
  DISCOURSE_HOSTNAME: 'discourse-forum.ru'
expose:
  - "14579:5432" # PostgreSQL
  - "2223:22" # SSH
  - "4579:80"
hooks:
  after_code:
    - exec:
        cd: $home/plugins
        cmd:
          - mkdir -p plugins
          - git clone https://github.com/discourse/discourse-post-voting
          - git clone https://github.com/discourse/discourse-solved
          - git clone https://github.com/discourse/discourse-vk-auth
          # «The docker manager plugin allows you to one-click upgrade Discourse»
          - git clone https://github.com/discourse/docker_manager
          - git clone ${my}df-core
          - git clone ${my}df-core-private
          #- git clone ${my}df-github-blob-onebox
          - git clone ${my}df-qa
          - git clone ${my}russian-localization
params:
  db_default_text_search_config: "pg_catalog.english"
  upload_size: 60m # 2018-06-18 https://meta.discourse.org/t/26435/2
  version: tests-passed
templates:
# 2024-05-31
# "Consolidate the duplicated code from all Discourse YML files to a single file":
# https://github.com/dmitrii-fediuk/5.9.188.84/issues/63
  - "container.yml"
# 2024-05-30
# "Consolidate the sensitive data from all Discourse YML files to a single YML file,
# and then add the rest Discourse YML files to Git": https://github.com/dmitrii-fediuk/5.9.188.84/issues/60
  - "credentials.yml"
  - "templates/postgres.template.yml"
  - "templates/redis.template.yml"
  - "templates/sshd.template.yml"
  - "templates/web.template.yml"
## These containers are stateless, all data is stored in /shared
volumes:
  - volume:
      guest: /shared
      host: /usr/local/discourse/shared/discourse-forum.ru
  - volume:
      guest: /var/log
      host: /usr/local/discourse/shared/discourse-forum.ru/log/var-log