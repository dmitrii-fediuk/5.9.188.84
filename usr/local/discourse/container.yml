# 2024-05-31
# "Consolidate the duplicated code from all Discourse YML files to a single file":
# https://github.com/dmitrii-fediuk/5.9.188.84/issues/63
env:
  DISCOURSE_LOAD_MINI_PROFILER: false
  DISCOURSE_SMTP_ADDRESS: smtp.postmarkapp.com
  DISCOURSE_SMTP_ENABLE_START_TLS: true
  DISCOURSE_SMTP_PORT: 587
  DISCOURSE_SMTP_USER_NAME: PM-T-outbound-85ylSjsEQpLZm674rSpbSi
  # 2020-09-05 https://meta.discourse.org/t/151236#lc-collate-values-for-database-%E2%80%9Cpostgres%E2%80%9D-do-not-match
  LANG: en_US.UTF-8
  LANGUAGE: en_US.UTF-8
  LC_ALL: en_US.UTF-8
  my: 'https://github.com/discourse-pro/'
  UNICORN_WORKERS: 4 # «How many concurrent web requests are supported? With 2GB we recommend 3-4 workers, with 1GB only 2.»
run:
  - exec: echo "Beginning of custom commands"
  # 2022-08-14 «Installing a Theme programatically»: https://meta.discourse.org/t/191843
  - file:
      path: /tmp/mythemes.yml
      # 2022-08-14 «DiscoTOC - automatic table of contents»: https://meta.discourse.org/t/111143
      contents: |
        toc:
          url: https://github.com/discourse/DiscoTOC.git
          add_to_all_themes: true
  - exec:
      cd: $home
      cmd: su discourse -c 'bundle exec rake themes:install < /tmp/mythemes.yml'
  - exec: echo "End of custom commands"
  - exec: awk -F\# '{print $1;}' ~/.ssh/authorized_keys | awk 'BEGIN { print "Authorized SSH keys for this container:"; } NF>=2 {print $NF;}'